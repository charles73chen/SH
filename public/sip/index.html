<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ctxSip</title>
    <link rel="icon" type="image/gif" href="img/favicon.ico" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css">



    <link href="css/ctxSip.css" rel="stylesheet" type="text/css" />
    <style>
        .w-100 {
            width: 100% !important;
        }

        .align-items-stretch {
            -webkit-box-align: stretch !important;
            -ms-flex-align: stretch !important;
            align-items: stretch !important;
        }

        .d-flex {
            display: -webkit-box !important;
            display: -ms-flexbox !important;
            display: flex !important;
        }

        .align-items-end {
            -webkit-box-align: end !important;
            -ms-flex-align: end !important;
            align-items: flex-end !important;
        }

        .align-items-center {
            -webkit-box-align: center !important;
            -ms-flex-align: center !important;
            align-items: center !important;
        }

        .justify-content-sm-start {
            -webkit-box-pack: start !important;
            -ms-flex-pack: start !important;
            justify-content: flex-start !important;
        }

        .justify-content-sm-end {
            -webkit-box-pack: end !important;
            -ms-flex-pack: end !important;
            justify-content: flex-end !important;
        }

        .justify-content-sm-center {
            -webkit-box-pack: center !important;
            -ms-flex-pack: center !important;
            justify-content: center !important;
        }

        .justify-content-sm-between {
            -webkit-box-pack: justify !important;
            -ms-flex-pack: justify !important;
            justify-content: space-between !important;
        }

        .justify-content-sm-around {
            -ms-flex-pack: distribute !important;
            justify-content: space-around !important;
        }

        .text-left {
            text-align: left !important;
        }

        .text-right {
            text-align: right !important;
        }

        .text-center {
            text-align: center !important;
        }

        .ion--call {
            display: inline-block;
            width: 1em;
            height: 1em;
            --svg: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%23000' d='M391 480c-19.52 0-46.94-7.06-88-30c-49.93-28-88.55-53.85-138.21-103.38C116.91 298.77 93.61 267.79 61 208.45c-36.84-67-30.56-102.12-23.54-117.13C45.82 73.38 58.16 62.65 74.11 52a176.3 176.3 0 0 1 28.64-15.2c1-.43 1.93-.84 2.76-1.21c4.95-2.23 12.45-5.6 21.95-2c6.34 2.38 12 7.25 20.86 16c18.17 17.92 43 57.83 52.16 77.43c6.15 13.21 10.22 21.93 10.23 31.71c0 11.45-5.76 20.28-12.75 29.81c-1.31 1.79-2.61 3.5-3.87 5.16c-7.61 10-9.28 12.89-8.18 18.05c2.23 10.37 18.86 41.24 46.19 68.51s57.31 42.85 67.72 45.07c5.38 1.15 8.33-.59 18.65-8.47c1.48-1.13 3-2.3 4.59-3.47c10.66-7.93 19.08-13.54 30.26-13.54h.06c9.73 0 18.06 4.22 31.86 11.18c18 9.08 59.11 33.59 77.14 51.78c8.77 8.84 13.66 14.48 16.05 20.81c3.6 9.53.21 17-2 22c-.37.83-.78 1.74-1.21 2.75a176.5 176.5 0 0 1-15.29 28.58c-10.63 15.9-21.4 28.21-39.38 36.58A67.4 67.4 0 0 1 391 480'/%3E%3C/svg%3E");
            background-color: currentColor;
            -webkit-mask-image: var(--svg);
            mask-image: var(--svg);
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-size: 100% 100%;
            mask-size: 100% 100%;
        }
    </style>
</head>

<body id="sipClient">
    <div class="container-fluid">

        <div class="clearfix sipStatus">
            <div id="txtCallStatus" class="pull-right">&nbsp;</div>
            <div id="txtRegStatus"></div>
        </div>

        <div class="form-group" id="phoneUI">
            <div class="input-group">
                <div class="input-group-btn">
                    <button class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown" title="Show Keypad">
                        <i class="fa fa-th"></i>
                    </button>
                    <div id="sip-dialpad" class="dropdown-menu">
                        <button type="button" class="btn btn-default digit" data-digit="1">1<span>&nbsp;</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="2">2<span>ABC</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="3">3<span>DEF</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="4">4<span>GHI</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="5">5<span>JKL</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="6">6<span>MNO</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="7">7<span>PQRS</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="8">8<span>TUV</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="9">9<span>WXYZ</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="*">*<span>&nbsp;</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="0">0<span>+</span></button>
                        <button type="button" class="btn btn-default digit" data-digit="#">#<span>&nbsp;</span></button>
                        <div class="clearfix">&nbsp;</div>
                        <button class="btn btn-success btn-block btnCall" title="Send">
                            <i class="fa fa-play"></i> Send
                        </button>
                    </div>
                </div>
                <input type="text" name="number" id="numDisplay" class="form-control text-center input-sm" value=""
                    placeholder="Enter number..." autocomplete="off" />
                <div class="input-group-btn input-group-btn-sm">
                    <button class="btn btn-sm btn-primary dropdown-toggle" id="btnVol" data-toggle="dropdown"
                        title="Volume">
                        <i class="fa fa-fw fa-volume-up"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-right">
                        <input type="range" min="0" max="100" value="100" step="1" id="sldVolume" />
                    </div>
                </div>
            </div>
        </div>
        <div class="row" id="communityList">
            <div class="col-xs-6 col-md-3">
                <a href="#" class="thumbnail">
                    A棟
                </a>
            </div>


        </div>
        <div>
            <div class="row " id='roomlist'>

                <div class="col-md-4 col-xs-4" style="margin-top: 5px">
                    <button type="button" class="btn btn-tertiary w-100 align-items-stretch d-flex"
                        onclick="document.getElementById('numDisplay').value='1104';ctxSip.phoneCallButtonPressed()">
                        <div class="text text-left" style="width:70%">
                            <h4>104</h4>
                            <span>頎</span>
                        </div>
                        <div class="icon icon-right d-flex align-items-center justify-content-sm-end"
                            style="width: 30%;text-align:right !important">
                            <i class="fas fa-phone-alt fa-3x"></i>
                        </div>
                    </button>
                </div>
                <div class="col-md-3 col-xs-4">
                    <button class="col-md-3 col-xs-4 btn btn-primary btn-lg" style="margin: 5px">Steven</button>
                </div>
                <div class="col-md-3 col-xs-4">
                    <button class="col-md-3 col-xs-4 btn btn-primary btn-lg" style="margin: 5px">Eric</button>
                </div>
                <div class="col-md-3 col-xs-4">
                    <button class="col-md-3 col-xs-4 btn btn-primary btn-lg" style="margin: 5px">頎</button>
                </div>
            </div>
        </div>
        <div class="well-sip" style="display: none">
            <div id="sip-splash" class="text-muted text-center panel panel-default">
                <div class="panel-body">
                    <h3 class="page-header">
                        <span class="fa-stack fa-2x">
                            <i class="fa fa-circle fa-stack-2x text-success"></i>
                            <i class="fa fa-phone fa-stack-1x fa-inverse"></i>
                        </span><br>
                        This is your phone.
                    </h3>
                    <p class="lead">To make a call enter a number or SIP address in the box above.</p>
                    <small>Closing this window will cause calls to go to voicemail.</small>
                </div>
            </div>

            <div id="sip-log" class="panel panel-default hide">
                <div class="panel-heading">
                    <h4 class="text-muted panel-title">Recent Calls <span class="pull-right"><i
                                class="fa fa-trash text-muted sipLogClear" title="Clear Log"></i></span></h4>
                </div>
                <div id="sip-logitems" class="list-group">
                    <p class="text-muted text-center">No recent calls from this browser.</p>
                </div>
            </div>
        </div>

        <div class="modal fade" id="mdlError" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static"
            data-keyboard="false">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Sip Error</h4>
                    </div>
                    <div class="modal-body text-center text-danger">
                        <h3><i class="fa fa-3x fa-ban"></i></h3>
                        <p class="lead">Sip registration failed. No calls can be handled.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <audio id="ringtone" src="sounds/incoming.mp3" loop></audio>
    <audio id="ringbacktone" src="sounds/outgoing.mp3" loop></audio>
    <audio id="dtmfTone" src="sounds/dtmf.mp3"></audio>
    <audio id="audioRemote"></audio>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="scripts/moment.js/moment.min.js"></script>

    <script type="text/javascript" src="scripts/SIP.js/sip.min.js"></script>
    <script type="text/javascript" src="scripts/config.js"></script>
    <script type="text/javascript" src="scripts/app.js"></script>
    <script src="/javascripts/publicVar.js"></script>
    <script src="/javascripts/publicFn.js"></script>
    <script>
        //$.LoadingOverlay("show");

        $(document).ready(function () {

            getCommunity();
        });

        function getRoomList(community) {
            ajaxdata.url = '/community/Ajax/GetAllRoom';
            ajaxdata.success = function (msg) {
                if (msg.state == '0') {
                    var html = "";
                    for (i = 0; i < msg.result.length; i++) {
                        html = html + "<div class='col-md-4 col-xs-4' style='margin-top: 5px'>"
                        html = html + "<button type='button' class='btn btn-tertiary w-100 align-items-stretch d-flex'"
                        html = html + "onclick=\"document.getElementById(\'numDisplay\').value='"+msg.result[i].SIP_ACCOUNT+"';ctxSip.phoneCallButtonPressed()\">"
                        html = html + "<div class='text text-left' style='width:70%'>"
                        html = html + "<h4>" + msg.result[i].ROOM_NAME + "</h4>"
                        html = html + "<span>"+msg.result[i].SIP_ACCOUNT+"</span>"
                        html = html + "</div>"
                        html = html + "<div class='icon icon-right d-flex align-items-center justify-content-sm-end'"
                        html = html + "style='width: 30%;text-align:right !important'>"
                        html = html + "<i class='fas fa-phone-alt fa-3x'></i>"
                        html = html + "</div>"
                        html = html + "</button>"
                        html = html + "</div>";
                    }
                    $('#roomlist').html(html);

                } else {
                    console.log(msg)
                    alert(msg.msg);
                }
            };
            ajaxdata.data = {
                "communityId": community
            }
            $.ajax(ajaxdata);
        }

        function getCommunity() {
            ajaxdata.url = '/community/Ajax/GetAllCommunity';
            ajaxdata.success = function (msg) {
                if (msg.state == '0') {
                    var html = "";
                    for (i = 0; i < msg.result.length; i++) {
                        html = html + "<div class='col-xs-6 col-md-3'>\n" +
                            "    <a href='#' class='thumbnail'>\n" +
                            "        " + msg.result[i].Community_NAME + "\n" +
                            "    </a>\n" +
                            "</div>"
                    }
                    $('#communityList').html(html);
                    if (msg.result.length > 0) {
                        getRoomList(msg.result[0].Community_ID);
                    }
                } else {
                    console.log(msg)
                    alert(msg.msg);
                }
            };
            ajaxdata.data = {}
            $.ajax(ajaxdata);
        }
    </script>
</body>

</html>